var Mahjongg=Ember.Application.create({rootElement:"#mahjongg"});Mahjongg.Tile=Ember.Object.extend({board:undefined,i:-1,j:-1,k:-1,tile:-1,selected:false,visible:true,clickable:(function(){return this.get("board").isTileFree(this)}).property("board.tilesCount")});Mahjongg.Board=Ember.Object.extend({width:30,height:16,depth:5,tilesCount:0,generate:function(){var b=[];for(var d=0;d<this.get("width");d++){b[d]=[];for(var c=0;c<this.get("height");c++){b[d][c]=[];for(var a=0;a<this.get("depth");a++){b[d][c][a]=undefined}}}this.set("tiles",b)},createLayout:function(){var b,a;for(b=1;b<=12;b++){this.putTile(b*2,0*2,0);this.putTile(b*2,3*2,0);this.putTile(b*2,4*2,0);this.putTile(b*2,7*2,0)}for(b=3;b<=10;b++){this.putTile(b*2,1*2,0);this.putTile(b*2,6*2,0)}for(b=2;b<=11;b++){this.putTile(b*2,2*2,0);this.putTile(b*2,5*2,0)}this.putTile(0*2,3*2+1,0);this.putTile(13*2,3*2+1,0);this.putTile(14*2,3*2+1,0);for(b=4;b<=9;b++){for(a=1;a<=6;a++){this.putTile(b*2,a*2,1)}}for(b=5;b<=8;b++){for(a=2;a<=5;a++){this.putTile(b*2,a*2,2)}}for(b=6;b<=7;b++){for(a=3;a<=4;a++){this.putTile(b*2,a*2,3)}}this.putTile(6*2+1,3*2+1,4)},putTile:function(d,c,b){var a=this.get("tiles");a[d][c][b]=-1},randomizeLayout:function(){var g,h,e,c,b;var l=this.get("tiles");var a=this.get("width");var m=this.get("height");var d=this.get("depth");var f=0;for(g=1;g<=34;g++){for(h=0;h<4;h++){do{e=Math.floor((Math.random()*a));c=Math.floor((Math.random()*m));b=Math.floor((Math.random()*d))}while(!l[e][c][b]||l[e][c][b]!=-1);l[e][c][b]=Mahjongg.Tile.create({i:e,j:c,k:b,tile:g,board:this});f++}}for(g=35;g<=42;g++){do{e=Math.floor((Math.random()*a));c=Math.floor((Math.random()*m));b=Math.floor((Math.random()*d))}while(!l[e][c][b]||l[e][c][b]!=-1);l[e][c][b]=Mahjongg.Tile.create({i:e,j:c,k:b,tile:g,board:this});f++}this.set("tilesCount",f)},tilesArray:(function(){var a=[];var c=this.get("tiles");for(var e=0;e<this.get("width");e++){for(var d=0;d<this.get("height");d++){for(var b=0;b<this.get("depth");b++){if(c[e][d][b]){a.push(c[e][d][b])}}}}return Em.A(a)}).property(),isCoordValid:function(c,b,a){return(c>=0&&c<30)&&(b>=0&&b<16)&&(a>=0&&a<5)},isTileFree:function(f){var c,a;var e=f.get("i");var d=f.get("j");var b=f.get("k");var h=this.get("tiles");if(b<this.get("depth")-1){for(c=-1;c<=1;c++){for(a=-1;a<=1;a++){if(this.isCoordValid(e+c,d+a,b+1)){if(h[e+c][d+a][b+1]&&h[e+c][d+a][b+1].get("visible")){return false}}}}}var g=false;var l=false;for(a=-1;a<=1;a++){if(this.isCoordValid(e-2,d+a,b)){if(h[e-2][d+a][b]&&h[e-2][d+a][b].get("visible")){g=true}}if(this.isCoordValid(e+2,d+a,b)){if(h[e+2][d+a][b]&&h[e+2][d+a][b].get("visible")){l=true}}}if(g&&l){return false}return true},areTilesEqual:function(b,a){var d=b.get("tile");var c=a.get("tile");if(d<35&&c<35){return(d==c)}if(d>=35&&d<=38&&c>=35&&c<=38){return true}if(d>=39&&d<=42&&c>=39&&c<=42){return true}return false}});Mahjongg.IndexRoute=Ember.Route.extend({setupController:function(a){a.send("newGame")}});Mahjongg.IndexController=Ember.Controller.extend({state:"game-won",selectedTile:undefined,actions:{newGame:function(){this.set("state","loading");var a=this;Ember.run.later(function(){var b=Mahjongg.Board.create();b.generate();b.createLayout();b.randomizeLayout();a.set("board",b);a.set("state","game")},500)},clickTile:function(c){var b=this.get("board");var d=this.get("selectedTile");if(!d){this.set("selectedTile",c);c.set("selected",true);return}if(d==c){this.set("selectedTile",undefined);c.set("selected",false);return}if(!b.areTilesEqual(c,d)){return}c.set("visible",false);d.set("visible",false);d.set("selected",false);this.set("selectedTile",undefined);var a=b.get("tilesCount")-2;b.set("tilesCount",a);if(a==0){this.set("state","game-won")}}}});Mahjongg.BoardView=Ember.View.extend({tagName:"section",templateName:"board",classNameBindings:[":board","controller.state"]});Mahjongg.TileView=Ember.View.extend({tagName:"span",classNameBindings:[":tile","tileClass","tile.visible","tile.clickable","tile.selected"],attributeBindings:["style"],click:function(){var a=this.get("tile");if(a.get("clickable")){this.get("controller").send("clickTile",a)}},tileClass:(function(){return"tile-"+this.get("tile").get("tile")}).property(),style:function(){var c=50+18*this.get("tile").get("i");var b=48+24*this.get("tile").get("j");var a=2*this.get("tile").get("k")+1;return"left:"+c+"px;top:"+b+"px;z-index:"+a+";"}.property()});Mahjongg.ShadowView=Ember.View.extend({tagName:"span",classNameBindings:[":tile-shadow","tile.visible","tile.selected"],attributeBindings:["style"],style:function(){var c=50+18*this.get("tile").get("i");var b=48+24*this.get("tile").get("j");var a=2*this.get("tile").get("k");return"left:"+c+"px;top:"+b+"px;z-index:"+a+";"}.property()});